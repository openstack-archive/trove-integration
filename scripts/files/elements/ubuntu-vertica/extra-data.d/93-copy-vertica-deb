#!/bin/bash

# CONTEXT: HOST prior to IMAGE BUILD as SCRIPT USER
# PURPOSE: Stages the package installer files from DATASTORE_PKG_LOCATION_DIR,
# so that guest image has the package files.

set -e
set -o xtrace

source $_LIB/die

[ -n "$TMP_HOOKS_PATH" ] || die "Temp hook path not set"
[ -d "$DATASTORE_PKG_LOCATION_DIR" ] || die "Datastore package installer files not found at the directory:" $DATASTORE_PKG_LOCATION_DIR

mkdir $TMP_HOOKS_PATH/vertica

# remove the version number form the debian package name before copying
for deb_file in `ls -1 $DATASTORE_PKG_LOCATION_DIR/*.deb`
do
    package_name=$(basename "$deb_file" ".deb")
    deb_file_name=`echo $package_name | cut -d "_" -f 1`
    cp $deb_file $TMP_HOOKS_PATH/vertica/$deb_file_name.deb
done
